---
image: ppa.png
page-layout: article
title-block-banner: pp.png
date: "2023-12-22"
title: "Utilizando Dplyr e ggplot2 | palmerpenguins"
author: "Gabriel Palucci Rosa"
toc: true
toc-title: "Table of Content"
categories:
  - Penguins
  - Dplyr
  - ggplot2
---

# Introdução

Ao analisarmos bases de dados com muitas colunas e linhas, torna-se essencial dominar ferramentas que facilitem o **manejo**, a **organização** e a **transformação** dos dados. Operações como selecionar variáveis específicas, filtrar observações ou criar novas colunas fazem parte da rotina de qualquer análise.

::: callout-note
## Características do pacote dplyr

-   **Rename:** Renomear coluna
-   **Slice:** Selecionar linhas
-   **Select:** Comparação sistemática de algoritmos
-   **Filter:** Análise de diferentes propriedades do solo
-   **Relocate:** Modificar a coluna 
-   **Arrange:** Organizar os dados de forma sequêncial
-   **Summarise:** Realizar métricas com os dados
-   **pivot longer:** Manipulação dos dados
:::


Algumas pessoas recorrem a softwares ou linguagens voltadas exclusivamente para bancos de dados (como SQL). No entanto, o **R** se destaca por permitir que toda a etapa de manipulação esteja integrada à análise estatística e à visualização de dados.

Neste post, apresento um guia **didático e progressivo** sobre a manipulação de dados com o pacote **dplyr**, parte do ecossistema **tidyverse**.

------------------------------------------------------------------------

## Instalação e carregamento dos pacotes

```{r}
library(pacman)
p_load(tidyverse, magrittr, palmerpenguins, ggthemes)
```

```{r}
pinguim <- dplyr::as_tibble(palmerpenguins::penguins)
```

------------------------------------------------------------------------

## Renomeando colunas com `rename()`

```{r}
pinguim <- pinguim %>% 
  rename(
    Especies = species, 
    Ilha = island,
    Tamanho_Bico_mm = bill_length_mm,
    Espessura_Bico_mm = bill_depth_mm,
    Nadadeira_mm = flipper_length_mm,
    Peso_g = body_mass_g,
    Sexo = sex,
    Ano = year
  )
```

------------------------------------------------------------------------

## Selecionando linhas com `slice()`

```{r}
pinguim %>% 
  slice(1:20)
```

------------------------------------------------------------------------

## Selecionando colunas com `select()`

```{r}
pinguim %>% 
  select(Especies, Ilha, Peso_g)
```

------------------------------------------------------------------------

## Criando variáveis com `mutate()`

```{r}
pinguim %>% 
  mutate(Relacao_Bico = Tamanho_Bico_mm / Espessura_Bico_mm) %>%
  select(Especies, Ilha, Relacao_Bico)
```

------------------------------------------------------------------------

## Filtrando dados com `filter()`

```{r}
pinguim %>% 
  filter(Peso_g > 1000, Espessura_Bico_mm > 10)
```

------------------------------------------------------------------------

## Reorganizando colunas com `relocate()`

```{r}
pinguim %>% 
  relocate(Ilha, Sexo, Especies)
```

------------------------------------------------------------------------

## Ordenando dados com `arrange()`

```{r}
pinguim %>% 
  select(Especies, Ilha, Peso_g) %>% 
  arrange(desc(Peso_g))
```

------------------------------------------------------------------------

## Agregando dados com `group_by()` e `summarise()`

```{r}
pinguim %>% 
  group_by(Ilha, Especies) %>%
  summarise(
    Peso_Maximo = max(Peso_g, na.rm = TRUE),
    Media_Nadadeira = mean(Nadadeira_mm, na.rm = TRUE),
    .groups = "drop"
  )
```

------------------------------------------------------------------------

## Reestruturando dados com `pivot_longer()`

```{r}
pinguim_long <- pinguim %>% 
  select(Especies, Sexo, Tamanho_Bico_mm, Espessura_Bico_mm, Nadadeira_mm) %>%
  pivot_longer(
    cols = c(Tamanho_Bico_mm, Espessura_Bico_mm, Nadadeira_mm),
    names_to = "Variavel",
    values_to = "Valor"
  )

pinguim_long
```

------------------------------------------------------------------------

## Exemplo integrado

```{r}
pinguim %>% 
  select(Especies, Ilha, Peso_g) %>% 
  arrange(desc(Peso_g)) %>% 
  slice(1:10)
```

------------------------------------------------------------------------

## Visualização dos dados

```{r}
ggplot(data = na.omit(pinguim), aes(x = Tamanho_Bico_mm, y = Espessura_Bico_mm)) +
  geom_point(aes(color = Especies, size = Peso_g), alpha = 0.7) +
  facet_wrap(~Sexo) +
  labs(
    x = "Tamanho do bico (mm)", 
    y = "Espessura do bico (mm)",
    color = "Espécie", 
    size = "Peso (g)"
  ) +
  theme_light() +
  theme_wsj()
```

------------------------------------------------------------------------

## Referências

-   Wickham et al. (2019). *Welcome to the tidyverse*. JOSS.
-   Horst et al. (2020). *palmerpenguins*.

![](https://www.tidyverse.org/images/hex-tidyverse.png){width="15%"} ![](https://magrittr.tidyverse.org/logo.png){width="15%"} ![](https://allisonhorst.github.io/palmerpenguins/reference/figures/logo.png){width="15%"}
